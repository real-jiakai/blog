{{ define "main" }}
<h1 class="mb-4">ðŸ“š {{ i18n "archiveTitle" | default "Archive" }}</h1>

{{ $posts := where .Site.RegularPages "Type" "==" "blog" }}
{{ $postsByYear := $posts.GroupByDate "2006" }}

{{ range $postsByYear }}
<div id="{{ .Key }}" class="mb-5">
    <h2 class="h3 mb-4">{{ .Key }}</h2>
    
    <!-- è¯¥å¹´ä»½çš„æ ‡ç­¾ç»Ÿè®¡ -->
    {{ $yearTags := slice }}
    {{ range .Pages }}
        {{ range .Params.tags }}
            {{ $yearTags = $yearTags | append . }}
        {{ end }}
    {{ end }}

    <!-- åˆ›å»ºå¸¦è®¡æ•°çš„æ ‡ç­¾åˆ‡ç‰‡ -->
    {{ $tagCounts := slice }}
    {{ range $tag := $yearTags | uniq }}
        {{ $count := 0 }}
        {{ range $yearTags }}
            {{ if eq . $tag }}
                {{ $count = add $count 1 }}
            {{ end }}
        {{ end }}
        {{ $tagCounts = $tagCounts | append (dict "name" $tag "count" $count) }}
    {{ end }}

    <!-- æŒ‰è®¡æ•°é™åºæŽ’åºå¹¶æ˜¾ç¤ºæ ‡ç­¾ -->
    <div class="mb-4">
        {{ range sort $tagCounts "count" "desc" }}
            <a href="{{ "/tags/" | relLangURL }}{{ .name | urlize }}" class="badge bg-secondary text-decoration-none me-2">
                #{{ .name }} ({{ .count }})
            </a>
        {{ end }}
    </div>

    <!-- æŒ‰æœˆä»½åˆ†ç»„æ–‡ç«  -->
    {{ $postsByMonth := .Pages.GroupByDate "January" }}
    {{ range $postsByMonth }}
    <div class="mb-4">
        <h3 class="h5 text-muted">{{ .Key }}</h3>
        <ul class="list-unstyled ps-3">
            {{ range .Pages.ByDate.Reverse }}
            <li class="mb-2 d-flex justify-content-between align-items-baseline">
                <a href="{{ .Permalink }}" class="text-decoration-none">{{ .Title }}</a>
                <span class="text-muted" style="font-family: monospace; min-width: 4em;">{{ .Date.Format "01-02" }}</span>
            </li>
            {{ end }}
        </ul>
    </div>
    {{ end }}
</div>
{{ end }}
{{ end }}